name: Combine and Upload MLB JSON

on:
  workflow_dispatch:
  schedule:
    # every day at 15:00â€¯UTC  (â‰ˆâ€¯08:00â€¯PT / 11:00â€¯ET)
    - cron: '0 15 * * *'

jobs:
  build-and-upload:
    runs-on: ubuntu-latest

    env:
      AWS_ACCESS_KEY_ID:     ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      AWS_REGION:            us-east-2
      COMBINE_BASE_DIR:      baseball
      UPLOAD_TO_S3:          "true"
      # FORCE_DATE: 2025-07-27     # â† Uncomment only when backâ€‘filling a slate

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v3

      - name: ğŸ Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: ğŸ“¦ Install project dependencies
        run: |
          pip install boto3 pandas

      - name: ğŸ“„ Download MLB JSON inputs from S3
        run: |
          aws s3 cp --recursive s3://fantasy-sports-csvs/baseball/ baseball/

      - name: ğŸ•µï¸ List downloaded JSON files
        run: |
          echo "Workspace contents:"
          find baseball -type f -name '*.json' | sort

      - name: ğŸ§  Combine and upload structured player JSON
        run: python mlb_combine_all_files.py
        env:
          COMBINE_BASE_DIR: baseball
          UPLOAD_TO_S3: "true"
          # FORCE_DATE: 2025-07-27   # Uncomment if needed
